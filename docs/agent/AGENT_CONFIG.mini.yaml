# üìò Docs-as-System ‚Äì mini edition
# ‚ö†Ô∏è System File
#
# This file is part of the official Docs-as-System methodology.
# End users must not modify this file.
# Update this file only through the methodology‚Äôs source repository.

# ============================================================================
# METADATA ‚Äî PROJECT + METHODOLOGY IDENTIFICATION
# ============================================================================

metadata:
  methodologyName: "Docs-as-System"
  edition: "mini"
  # ============================================================================
  # LANGUAGE SETTINGS ‚Äî DOCUMENT & UI LANGUAGE PREFERENCES
  # ============================================================================

  language:
    docs: "en"          # Language used inside the core project documents (BR, SPEC, BLUEPRINT, PLAN)
                        # User may write documents in any language ("he", "es", "ar", etc.)
                        # and the AI agent will understand them.

    ui: "en"            # UI language for validation messages in the VS Code extension.
                        # The extension will present messages, hints and instructions in this language.

  versionFile: "VERSION.txt"

  projectName: "REPLACE_ME"            # User must update
  environment: "dev"                   # User must update
  description: "Short system description"   # User must update

# ============================================================================
# ROOT PATHS ‚Äî TOP-LEVEL DOCUMENTS
# ============================================================================

paths:
  root:
    readme: "README.md"
    promptsIndex: "PROMPTS_INDEX.md"

  readablePaths: ["docs", "src", "tests"]
  writablePaths: ["src", "tests", "docs/logs", "docs/agent/notes"]
  protectedPaths: ["infra", "db", "deploy", "scripts"]

  readOnlyFiles:
    - "docs/project/ARCHITECTURE_BLUEPRINT.mini.md"
    - "docs/project/BUSINESS_REQUIREMENTS.mini.md"
    - "docs/project/PROJECT_SPEC.mini.md"

# ============================================================================
# DOCUMENT PATHS ‚Äî MUST MATCH THE FINAL STRUCTURE
# ============================================================================

documents:
  businessRequirementsPath: "docs/project/BUSINESS_REQUIREMENTS.mini.md"
  projectSpecPath: "docs/project/PROJECT_SPEC.mini.md"
  architectureBlueprintPath: "docs/project/ARCHITECTURE_BLUEPRINT.mini.md"
  implementationPlanPath: "docs/project/IMPLEMENTATION_PLAN.mini.md"

  implementationLogPath: "docs/logs/IMPLEMENTATION_LOG.mini.md"       
  implementationLogTemplatePath: "docs/project/templates/log/IMPLEMENTATION_LOG_TEMPLATE.mini.md"

  agentPolicyPath: "docs/agent/AGENT_OPERATIONAL_POLICY.mini.md"
  humanPolicyPath: "docs/agent/HUMAN_OPERATIONAL_POLICY.mini.md"

# ============================================================================
# AGENT BEHAVIOR SETTINGS
# ============================================================================

agent:
  maxFilesPerTask: 12
  maxLinesPerFileEdit: 120
  allowRefactorAcrossFiles: false

  requirePlanBeforeChanges: true
  requireSelfCheckBeforeCommit: true
  requireUnitTestsForNewCode: true
  requireUnitTestsForLogicChange: true

  unitTestFolders: ["tests", "src/**/__tests__"]
  clientSideFolders: ["src/client", "src/ui"]
  serverSideFolders: ["src/server", "src/api"]

  preEditChecks:
    - "Read relevant parts of PROJECT_SPEC"
    - "Read relevant parts of ARCHITECTURE_BLUEPRINT"
    - "Confirm that file is not inside protectedPaths"
    - "Confirm that change matches the active task inside IMPLEMENTATION_PLAN"

# ============================================================================
# GIT RULES
# ============================================================================

git:
  defaultBranch: "main"
  workingBranchPattern: "feature/*|bugfix/*|chore/*"

  allowAgentCommit: true
  allowAgentPush: false

  protectedBranches:
    - "main"
    - "master"
    - "release/*"

  allowedPaths:
    - "src"
    - "tests"
    - "docs/logs"
    - "docs/agent"

  commitMessage:
    includeTags: true
    trailers:
      - "Reviewed-by: HUMAN_REQUIRED"
      - "Docs-as-System mini"

# ============================================================================
# LOGGING RULES ‚Äî ALWAYS IN ENGLISH
# ============================================================================

logging:
  implementationLogPath: "docs/logs/IMPLEMENTATION_LOG.mini.md"
  summariesFolderPath: "docs/logs/summaries"

  language: "en"                       # Required: implementation log is always in English

  requireLogPerTask: true

  logEntryTemplate:
    fields:
      - "dateTime"
      - "actor"
      - "stepName"
      - "taskName"
      - "filesChanged"
      - "summary"
      - "testsSummary"
      - "reviewStatus"

# ============================================================================
# SAFETY RULES
# ============================================================================

safety:
  requireHumanApprovalFor:
    - "schema changes"
    - "database migrations"
    - "security sensitive code"
    - "changes in protectedPaths"

  forbiddenActions:
    - "Delete files outside writablePaths"
    - "Change CI/CD configuration"
    - "Change deployment scripts"
    - "Modify database connection configuration"
    - "Edit prompt files in prompts library"

  onUnclearInstruction:
    - "Stop action"
    - "Summarize current understanding"
    - "Ask human for clarification"

  onTestFailure:
    - "Do not commit"
    - "Analyze failure cause"
    - "Propose fix"
    - "Apply fix only after human confirmation for risky areas"

# ============================================================================
# PROMPTS ‚Äî STRUCTURE AND PATHS
# ============================================================================

prompts:
  libraryFolder: "docs/prompts/PROMPTS_LIBRARY"
  humanEditFolder: "docs/prompts/HUMAN_EDIT_MODE"

  files:
    understandContext: "prompt_understand_context.mini.md"
    prepareStep: "prompt_prepare_step.mini.md"
    executeTask: "prompt_execute_task.mini.md"
    selfCheck: "prompt_self_check.mini.md"
    updateLog: "prompt_update_log.mini.md"
    prepareCommit: "prompt_prepare_commit.mini.md"
    preparePullRequest: "prompt_prepare_pull_request.mini.md"
    generateSummary: "prompt_generate_summary.mini.md"
    mainOrchestration: "prompt_main_orchestration.mini.md"

  humanEditFiles:
    analyzeHumanChanges: "prompt_analyze_human_changes.mini.md"
    humanEditMode: "prompt_human_edit_mode.mini.md"

# ============================================================================
# AUTOMATION COMMANDS
# ============================================================================

commands:
  createBranch: "docs/automation/CREATE_BRANCH.sh"
  stageAndCommit: "docs/automation/STAGE_AND_COMMIT.sh"
  pushBranch: "docs/automation/PUSH_BRANCH.sh"
  openPullRequest: "docs/automation/OPEN_PULL_REQUEST.sh"

# ============================================================================
# FINAL SELF CHECK
# ============================================================================

selfCheck:
  checklist:
    - "All changes align with docs/project/PROJECT_SPEC.mini.md"
    - "No violation of docs/project/ARCHITECTURE_BLUEPRINT.mini.md"
    - "Change matches the active task in docs/project/IMPLEMENTATION_PLAN.mini.md"
    - "Unit tests added or updated for each new or changed logic path"
    - "All tests pass locally"
    - "Implementation log in docs/logs/IMPLEMENTATION_LOG.mini.md is updated for this task"
    - "Commit message is clear and scoped to a single task"

# ============================================================================
# FOOTER ‚Äì SYSTEM PROTECTION
# ============================================================================

# This file is a protected system component.
# It is part of the official Docs-as-System methodology
# and must not be modified by end users.
#
# ¬© 2025 Tomer Kedem
